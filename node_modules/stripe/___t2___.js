var stripe = require('./lib/stripe')(
    'sk_test_YizMR5Q9Kwq4lKqmdPVOTCw2'
);
var async = require('async');

var createCustomer = function (email) {
    stripe.customers.create({
        id: email
    }, function (e, customer) {
        if (e) {
            throw e;
        }

        console.log('Customer=', customer);
    });
};

var clearCustomers = function () {
    stripe.customers.list({}, function (e, customers) {
        if (e) {
            throw e;
        }

        console.log('Customers', customers);

        async.each(customers.data, function (customer, cb) {
            stripe.customers.del(customer.id, function() {
                console.log('Deleted 1');
                cb();
            });
        }, function (e) {
            if (e) {
                throw e;
            }

            createCustomer('info@DOMAIN_OF_ACCOUNT_HOLDER');
        });
    });
};

clearCustomers();